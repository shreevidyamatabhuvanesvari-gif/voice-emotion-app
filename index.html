<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <title>Anjali тАУ Voice Auto Active</title>
</head>
<body>

<h2>Anjali</h2>

<button onclick="startListening()">ЁЯОд рд╕реБрдирд┐рдП</button>

<p><b>рд╕реБрдирд╛ рдЧрдпрд╛:</b> <span id="heard"></span></p>
<p><b>рдЙрддреНрддрд░:</b> <span id="response"></span></p>

<script>
/* ---------- Speech Recognition ---------- */
const SpeechRecognition =
    window.SpeechRecognition || window.webkitSpeechRecognition;

const recognition = new SpeechRecognition();
recognition.lang = "hi-IN";
recognition.continuous = false;
recognition.interimResults = false;

function startListening() {
    recognition.start();
}

/* ---------- рд╕реБрдирдиреЗ рдХреЗ рдмрд╛рдж ---------- */
recognition.onresult = function(event) {
    const spokenText = event.results[0][0].transcript;
    document.getElementById("heard").innerText = spokenText;
    sendToBackend(spokenText);   // рд╕реАрдзреЗ рдПрдХреНрдЯрд┐рд╡
};

/* ---------- Backend ---------- */
function sendToBackend(text) {
    fetch("http://127.0.0.1:5000/chat", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message: text })
    })
    .then(res => res.json())
    .then(data => {
        document.getElementById("response").innerText = data.reply;
        speak(data.reply);
    });
}

/* ---------- рдмреЛрд▓рдирд╛ ---------- */
function speak(text) {
    if (!text) return;

    const utterance = new SpeechSynthesisUtterance(text);

    const voices = speechSynthesis.getVoices();
    const hindi = voices.find(v => v.lang.startsWith("hi"));
    if (hindi) utterance.voice = hindi;

    window.speechSynthesis.cancel();
    window.speechSynthesis.speak(utterance);
}
</script>

</body>
</html>
